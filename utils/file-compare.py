#!/usr/bin/env python
# -*- coding: utf-8 -*-

#
# Name:       File comparison utility
# Author:     Nathan Bird
# Website:    https://github.com/milbot/pentest-framework
# Date:       23 July 2014
# Licence:    GNU GENERAL PUBLIC LICENSE v2
#
# ndiff:      lists every line and highlights interline changes
# context:    highlights clusters of changes in a before/after format
# unified:    highlights clusters of changes in an inline format
# html:       generates side by side comparison with change highlights
#

import sys, os.path, difflib
from optparse import OptionParser

def main():
    parser = OptionParser(usage="usage: %prog [options] file1 file2",
                          version="%prog 1.0")
    parser.add_option("-o", "--output_file",
        action="store",
        dest="outputfile",
        default=False,
        help="Filename to output changes to, instead of to the display")
    parser.add_option("-f", "--output_format",
        action="store",
        dest="outputformat",
        default="ndiff",
        help="Output format - ndiff, context, unified (default: ndiff)")

    (options, args) = parser.parse_args()

    if len(args) != 2:
        parser.error("Wrong number of arguments")

    file1 = args[0]
    file2 = args[1]
    outputformat = options.outputformat

    if os.path.isfile(file1) and os.path.isfile(file2):
        if outputformat == "context":
            diff = difflib.context_diff(open(file1).readlines(),open(file2).readlines())
        elif outputformat == "unified":
            diff = difflib.unified_diff(open(file1).readlines(),open(file2).readlines())
        else:
            diff = difflib.ndiff(open(file1).readlines(),open(file2).readlines())

        sys.stdout.writelines(diff)

if __name__ == '__main__':
    main()
